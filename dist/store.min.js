!function(a,b){typeof exports==='object'&&typeof module!=='undefined'?b(exports,require('rxjs'),require('rxjs/operators'),require('json-local-session-storage'),require('ramda'),require('obj-list'),require('split-trim')):typeof define==='function'&&define.amd?define(['exports','rxjs','rxjs/operators','json-local-session-storage','ramda','obj-list','split-trim'],b):(b((a.store={}),a.rxjs,a.operators,a.jsonLocalSessionStorage,a.ramda,a.objList,a.splitTrim))}(this,(function(a,b,c,d,e,f,g){'use strict';function h(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function j(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value" in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}function k(a,b,c){b&&j(a.prototype,b);c&&j(a,c);return a}function l(a,b,c){b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):(a[b]=c);return a}function m(a){for(var b=1;b<arguments.length;b++){var c=arguments[b]!=null?arguments[b]:{},d=Object.keys(c);typeof Object.getOwnPropertySymbols==='function'&&(d=d.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable})));d.forEach(function(b){l(a,b,c[b])})}return a}function n(a,b){return o(a)||p(a,b)||q()}function o(a){if(Array.isArray(a))return a}function p(a,b){var c=[],d=!0,e=!1,f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=!0,f=a}finally{try{!d&&g["return"]!=null&&g["return"]()}finally{if(e)throw f}};return c}function q(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var r=/^([A-Za-z0-9.])+(\[.+?\])*([A-Za-z0-9.]*)*(\s*:(just|not)\s*\([A-Za-z0-9,.\s]+\))*(\s*--\s*[A-Za-z0-9]+)*$/m;function s(a){var b=a.name,c=a.propName,d=a.storePath,h=a.just,i=a.not,j=a.data,k=j===void 0?{}:j,l=d.reduce(function(a,b){if(f.isObject(b)){a=f.objList.get(a,b.key,b.value);return a}a=a?a[b]:null;return a},k);if(!l){return t(b,c,l)}if(h){return t(b,c,h.reduce(function(a,b){if(b.match(/\./)){var c=g.splitTrim(b,'.');a[c[c.length-1]]=e.path(c,l);return a}a[b]=e.pick([b],l)[b];return a},{}))}else if(i){return t(b,c,e.omit(i,l))};return t(b,c,l)}var t=function d(a,b,c){return a&&!b?l({},a,c):c};function u(a){var b=g.splitTrim(a,':just'),c=n(b,2),d=c[0],e=c[1];if(!e){var f=g.splitTrim(a,':not'),h=n(f,2),i=h[0],j=h[1];if(j){j=g.splitTrim(j.replace(/[()]/g,''),',');return{path:i,not:j}}else{return{path:i}}}else e=g.splitTrim(e.replace(/[()]/g,''),',');return{path:d,just:e}}function v(a){if(!a.match(/\./)){return{store:a,storePath:[]}}var b=g.splitTrim(a,'.'),c=b.shift().trim(),d=b.reduce(function(a,b){if(b.match(/[[:]/)){var c=g.splitTrim(b.replace(/\[\]/,''),':');a.push({key:c[0].replace('[','').trim(),value:c[1].replace(']','').trim()})}else a.push(b);return a},[]);return{store:c,storePath:d}}function w(a){a=g.splitTrim(a,'\n').join('');var b=g.splitTrim(a,'|'),c=b.length;if(!b||!b.length){throw new Error('Trying to parse a store path that is badly formed:\n\n'+a+'\n')}var d=b.reduce(function(a,b){a.push(x(b,c));return a},[]);return d.length===1?d[0]:d}function x(a,b){if(!r.test(a)){throw new Error('Trying to parse a store path that is badly formed:\n\n'+a+'\n')}var c,d=g.splitTrim(a,'--'),e=n(d,2),h=e[0],i=e[1],j=u(h),k=j.path,l=j.just,m=j.not,o=v(k),p=o.store,q=o.storePath;l&&l.length===1&&(q.push(l[0]),l=void 0);q.length&&!f.isObject(q[q.length-1])&&(c=q[q.length-1]);if(b>1&&!i){if(c)i=c;else if(q.length){throw new Error('Trying to parse a multi-store path where one of the paths needs a name such as :\n\n'+a+' -- someName\n')}else i=p}else !i&&c&&(i=c);return{name:i,store:p,propName:c,storePath:q,just:l,not:m}}var y=!1,z=!1,A={},B=function a(){},C=Symbol('data'),D=Symbol('updated'),E=Symbol('not-updated'),F=Symbol('updateData'),G=Symbol('debug'),H=Symbol('subscribeToProperty'),I=function(){function a(c,e,f){h(this,a);this.name=c;this[C]=new WeakMap();var g=f.session&&d.session.getItem(c);this[C].set(this,g||e);this.props=[];this.data$=new b.BehaviorSubject(this.data);this.onSubscribeCallback=f.fetchData||B;this.debugTimer=null;this.useLocalSession=f.session;if(!A[c])A[c]=this;else{throw new Error("Trying to create a store with a name that's already in use")}}k(a,[{key:"setOnSubscribeCallback",value:function b(a){this.onSubscribeCallback=a}},{key:"useSession",value:function a(){this.useLocalSession=!0}},{key:"subscribe",value:function b(a){var c=a.callback,d=a.storePath,e=a.just,f=a.not,g=a.filter;d=d||[];this.onSubscribeCallback();return this[H](function(a){return s({storePath:d,just:e,not:f,data:a})},c,g)}},{key:H,value:function f(a,b,d){var g=this,h=a(this._data);return this.data$.pipe(c.startWith(this._data),c.map(function(b){if(g.silent){h=a(b);return h}else{return a(b)}}),c.filter(function(a){return!g.silent&&!e.equals(h,a)}),c.map(function(a){h=a;return h}),c.filter(function(a){if(d){return a[d.key]!==d.value}return !0}),c.debounceTime(100)).subscribe(b)}},{key:"update",value:function b(a){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!1;if(e.equals(this._data,a))this[G](E,a);else{var f=this[F](a);this[G](D,a,f);this[C].set(this,f);f=null;this.silent=c;this.data$.next(this._data);(z||this.useLocalSession)&&d.session.setItem(this.name,this.data)}}},{key:"silentUpdate",value:function b(a){this.update(a,!0)}},{key:F,value:function b(a){if(f.isObject(a)){return m({},this._data,a)}else{return a}}},{key:G,value:function d(a,b,c){var f=this,g=e.clone(this._data);clearTimeout(this.debugTimer);this.debugTimer=setTimeout(function(){if(y){switch(a){case D:console.log.green(f.name,g,c);break;case E:console.log.yellow("Store skipped update: ".concat(f.name),g,b);break;default:return void 0}}},1000)}},{key:"data",get:function a(){return e.clone(this._data)}},{key:"_data",get:function a(){return this[C].get(this)}}]);return a}(),J=function b(a){var c=w(a);return s(m({},c,{data:K(c.store).data}))};function K(a){if(A[a]){return A[a]}throw new Error('Failed to access the store with the name: '+a)}function L(a){var b=J(a);if(b===null||b===undefined){throw new Error('Failed to access the store with the name: '+a)}return b}var M=function c(a,b){var d=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return new I(a,b,d)},N=function b(a){y=a},O=function b(a){z=a};a.Store=K;a.Data=L;a.registerStore=M;a.setStoreDebugging=N;a.setStoreSession=O;Object.defineProperty(a,'__esModule',{value:!0})}))
//# sourceMappingURL=store.min.js.map
